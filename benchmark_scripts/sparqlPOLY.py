from SPARQLWrapper import SPARQLWrapper, JSON, POST
import time

sparql = SPARQLWrapper("http://localhost:8082/sparql")
sparql.setReturnFormat(JSON)

def benchmark(poly):
    """
    Records the query processing time for a SPARQL query with different LIMIT values.
    
    Args:
        limit: The LIMIT value for the SPARQL query
        
    Returns:
        float: The time taken to execute the query in seconds
    """
    query = f"""
        PREFIX :	<https://github.com/aghoshpro/OntoRaster/>
        PREFIX rdfs:	<http://www.w3.org/2000/01/rdf-schema#>
        PREFIX geo:	<http://www.opengis.net/ont/geosparql#>
        PREFIX rasdb:	<https://github.com/aghoshpro/RasterDataCube/>

        SELECT ?clipped {{
        ?gridCoverage a :Raster .
        ?gridCoverage rasdb:rasterName ?rasterName .
        FILTER (CONTAINS(?rasterName, 'Elevation')) 
        BIND ('{poly}'^^geo:wktLiteral AS  ?customRegionWkt)
        BIND ('2000-02-11T00:00:00+00:00'^^xsd:dateTime AS ?timeStamp)
        BIND (rasdb:rasSpatialAverage(?timeStamp, ?customRegionWkt, ?rasterName) AS ?clipped) 
        }}
    """
    
    sparql.setQuery(query)
    sparql.setMethod(POST)
    # Measure the query execution time
    start_time = time.time()
    results = sparql.query()
    end_time = time.time()
    try:
        ret = sparql.queryAndConvert()

        for r in ret["results"]["bindings"]:
            print(r)
    except Exception as e:
        print(e)
    
    # Calculate the processing time
    processing_time = end_time - start_time
    
    return processing_time

poly = 'POLYGON ((11.678897478133631 48.15486111114964, 11.661429333191359 48.15287790739294, 11.624947401869 48.15210288827121, 11.634594495358694 48.1502348880212, 11.664176701431098 48.146703481676056, 11.623695595495876 48.148019659283975, 11.697295341240434 48.139199823905585, 11.68962572088728 48.13741169923388, 11.66414003696747 48.13827209587523, 11.663133312801587 48.136239035304406, 11.645848027758737 48.13699872652918, 11.662182602482957 48.131948332563454, 11.670527612725955 48.127902309326956, 11.65397763483463 48.129175576955646, 11.668840456898959 48.12320754972263, 11.667191207045093 48.121011584460156, 11.670800155253364 48.117261406686126, 11.672323772338954 48.11390472600167, 11.61408731006766 48.130522702443926, 11.628515792767677 48.123557092486436, 11.619243039233313 48.1249500946938, 11.615056189377011 48.12462433683221, 11.616439987425556 48.121963951946476, 11.62586478101888 48.11531597169106, 11.602641354650482 48.124352030520846, 11.62832107629629 48.108553565621406, 11.604902778550574 48.1188551380866, 11.630790853722113 48.10063381198444, 11.595645860647902 48.1198558222664, 11.623961604756065 48.09770476618085, 11.621734363537774 48.09533599262804, 11.610357629086684 48.100132099139515, 11.618546654661623 48.0890122915313, 11.593531907961072 48.10708871370869, 11.603082748996371 48.09368321067813, 11.586842061549268 48.1061373914004, 11.581276727833163 48.108365786960036, 11.58142443660384 48.103754289198825, 11.591487128163635 48.08417851973309, 11.576194831460782 48.100580065401736, 11.569090180764228 48.10660175112415, 11.575355807067652 48.087401317094375, 11.56196642342445 48.10820675839451, 11.56501745803023 48.09146821980229, 11.559534584701634 48.09614200481169, 11.55569104657815 48.09656268880761, 11.549401332588939 48.1116396223861, 11.549913876144872 48.08215981087099, 11.545837033336484 48.07193215005151, 11.54077403854496 48.08004405643154, 11.535987530989834 48.07874267576781, 11.53360385754085 48.0957232273303, 11.52995708677678 48.09613083963017, 11.520069376370914 48.073118729748515, 11.515401542669817 48.07483492426407, 11.515156411239376 48.08729217263582, 11.51263976367719 48.09144344093455, 11.51276101954433 48.09966683366145, 11.516308979352456 48.11188969280543, 11.50880269525167 48.1050805583277, 11.512560705982537 48.11496411029726, 11.490040078340934 48.090700342675184, 11.477550807575534 48.08197065164771, 11.486829858708843 48.09745624082854, 11.474708465198965 48.09016502944212, 11.46330898747355 48.08472562628624, 11.487821152734199 48.1099915273605, 11.48116306065918 48.10791670884468, 11.455993979190126 48.0928995332714, 11.483393476464393 48.11540409351701, 11.47699073156664 48.11389544740824, 11.456346693914796 48.10429253958118, 11.470727893109261 48.11542873695458, 11.442718292396018 48.10335208368809, 11.466143354192347 48.117969092487236, 11.447950049834288 48.11198093674007, 11.4182142873671 48.10197924393254, 11.41729118082457 48.104987942590604, 11.432437405117723 48.11389150023619, 11.432620359180696 48.11666890289639, 11.426820037066214 48.1173731590251, 11.449478075236975 48.12685684785843, 11.449196286714276 48.12880489100089, 11.447026445306802 48.13020433996556, 11.425239506175995 48.12693589496702, 11.446046085253034 48.13382134602948, 11.4651297887902 48.1394942432082, 11.465000501518528 48.140920062139195, 11.423237091537732 48.13554257310375, 11.426816937447692 48.13820570413086, 11.391049193506452 48.13570919405789, 11.392520305367006 48.138505979663236, 11.45768414378878 48.14709023754248, 11.413441030719724 48.1451986056649, 11.449471890636858 48.14946809712229, 11.412242874966726 48.14946935742992, 11.415610974979543 48.15171443494543, 11.411924820349808 48.15378236190246, 11.44261934209351 48.15568519351518, 11.433405819348584 48.1575645587022, 11.448985964475618 48.15872543778951, 11.442963544095278 48.160633692981115, 11.444821369765695 48.16216404742657, 11.443797297118858 48.163912693814595, 11.451655494655167 48.16474363518324, 11.398610733263334 48.17305330299093, 11.433463753783863 48.17055492841167, 11.437005433774983 48.17193897718318, 11.407643261582058 48.17919440238937, 11.430729663365018 48.177109767208364, 11.394992673405595 48.187101816544555, 11.44708766071758 48.17755848995221, 11.458419104770911 48.17655842048129, 11.421131208764587 48.18880179895115, 11.428446183750511 48.18923507005764, 11.447583815022059 48.18558775581908, 11.421132367313223 48.19706663245023, 11.4196296456583 48.20062245896793, 11.429934067289281 48.199675921913865, 11.426537960390945 48.20418546755475, 11.432253567408239 48.20490200941697, 11.43053157890395 48.209085206092375, 11.456714319370462 48.199104697768945, 11.485431549578887 48.18615211830291, 11.443975664145256 48.212738114310504, 11.465284978877284 48.203209477237046, 11.465902605905901 48.20610508315275, 11.47814990623131 48.20085051023144, 11.471010169130352 48.209647082611696, 11.485106865701352 48.20198090784305, 11.462052923141378 48.2261168881095, 11.472469851816511 48.22171124067365, 11.474910380398882 48.22468077326191, 11.478457203567997 48.22672557455034, 11.494021078859983 48.21410082824194, 11.496047610607027 48.21717945845253, 11.50901935846168 48.20431622507261, 11.501741730118788 48.222250863956404, 11.514411307222494 48.206934218441845, 11.517384080839184 48.208011700024734, 11.519314953358554 48.211940728759984, 11.516311829053938 48.23214280729008, 11.524822816605397 48.21884091813754, 11.52819646234795 48.222217299533874, 11.53029829972926 48.237436637411065, 11.53775979965036 48.20833320151834, 11.541041117910112 48.21260537827509, 11.545443575267592 48.22940771544842, 11.54704507456812 48.201391711564995, 11.5494453089387 48.198337494887156, 11.557431013487331 48.220538617050956, 11.562144865121011 48.22229381108928, 11.56160252540072 48.208871506689825, 11.571972992488458 48.224832340006905, 11.566946915797065 48.20534278671567, 11.580496264849167 48.22339806880736, 11.591418182643618 48.23326858273386, 11.588780721701998 48.221682470032746, 11.601186806748329 48.23155030729291, 11.589946932719888 48.21160562385214, 11.603855704973913 48.22204834962797, 11.593182640909262 48.20613249177667, 11.585289543793657 48.195000694916736, 11.58437669362356 48.1913367365135, 11.59194404787677 48.19485967152837, 11.605946636920002 48.20260822176127, 11.610607584015977 48.2027112692994, 11.618566421015943 48.20480717615966, 11.599714267545417 48.190120853274415, 11.608285365260095 48.19280159102093, 11.607871904521678 48.19020561108595, 11.650298013540707 48.2093246376286, 11.65636497229926 48.20877862287295, 11.61142612560372 48.18554415385677, 11.656613870581952 48.202284867245, 11.659914670014102 48.20051018624728, 11.64583228965883 48.19242673890661, 11.670560237517172 48.19825145489255, 11.635196629112357 48.18415465371286, 11.638430150291002 48.18301534662685, 11.634510494783708 48.179878260705905, 11.648055654820277 48.18133000998035, 11.65220974717655 48.180141326716736, 11.655884705124885 48.178749874728375, 11.627785361900782 48.17121909573073, 11.695904894531225 48.18132892571529, 11.69085576068602 48.1777430627917, 11.634882941274673 48.167478244972784, 11.643708339283052 48.166885114204824, 11.622322410563656 48.16296420190341, 11.652991730607395 48.16415424835136, 11.644580792819722 48.16171093394762, 11.658759980466918 48.16069397070219, 11.624993709335785 48.157620872844504, 11.691806153914255 48.15734850774287, 11.678897478133631 48.15486111114964))'
time_taken = benchmark(poly)
print(time_taken)
